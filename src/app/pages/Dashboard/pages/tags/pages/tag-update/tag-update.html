<div class="tag-update-luxury">
  <div class="luxury-card shadow-lg animate__animated animate__fadeIn">
    
    <div class="card-header-luxury">
      <h2 class="merriweather-font gold-text">UPDATE TAG DETAILS</h2>
      <p class="text-white-50 small mb-0">Modify information for ID: #{{tagId}}</p>
    </div>

    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-gold"></div>
      <p class="mt-2 gold-text">Fetching Data...</p>
    </div>

    <form (ngSubmit)="onSubmit($event)" class="p-4 p-md-5" *ngIf="!isLoading" novalidate>
      <div class="form-grid">
        
        <div class="input-field full-width">
          <label [class.text-danger]="formSubmitted && !tagName">TAG NAME *</label>
          <input type="text" [(ngModel)]="tagName" name="tagName" 
                 [class.invalid-border]="formSubmitted && !tagName"
                 placeholder="Update name..." required>
          <span class="error-msg" *ngIf="formSubmitted && !tagName">Field Required</span>
        </div>

        <div class="input-field">
          <label [class.text-danger]="formSubmitted && selectedDivision === null">DIVISION (CATEGORY) *</label>
          <select [(ngModel)]="selectedDivision" name="division" 
                  [class.invalid-border]="formSubmitted && selectedDivision === null" required>
            <option [ngValue]="null" disabled>Select Category</option>
            <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
          </select>
        </div>

        <div class="input-field">
          <label>TYPE</label>
          <select [(ngModel)]="selectedType" name="type">
            <option [value]="1">Identity</option>
            <option [value]="2">Professional</option>
            <option [value]="3">Interest</option>
            <option [value]="4">Location</option>
          </select>
        </div>

        <div class="col-12 luxury-field position-relative mt-3">
          <label>PARENT TAG (SEARCH TO CHANGE)</label>
          <div class="search-box">
            <input type="text" (input)="onSearchParent($event)" placeholder="Search tags to link as parent...">
            <div class="linked-info mt-2">Currently Linked: <strong class="gold-text">{{ selectedParentName }}</strong></div>
          </div>
          
          <ul class="results-dropdown shadow" *ngIf="parentSearchResults.length > 0">
            <li (click)="selectParent(0)">-- NO PARENT (TOP LEVEL) --</li>
            <li *ngFor="let tag of parentSearchResults" (click)="selectParent(tag)">
              {{ tag.name | uppercase }} <small>(ID: {{ tag.id }})</small>
            </li>
          </ul>
        </div>

      </div>

      <div class="actions mt-5 d-flex justify-content-end gap-3">
        <button type="button" class="btn-cancel-luxury" (click)="onCancel()">CANCEL</button>
        <button type="submit" class="btn-save-gold" [disabled]="isSubmitting">
          <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
          SAVE CHANGES
        </button>
      </div>
    </form>
  </div>
</div>