<div class="page-container">
  
  <div *ngIf="isLoading" class="state-container">
    <div class="spinner-border text-gold" role="status"></div>
    <p>Loading...</p>
  </div>

  <div *ngIf="errorMessage" class="state-container text-danger">
    <i class="bi bi-exclamation-triangle"></i>
    <p>{{ errorMessage }}</p>
    <a routerLink="/admin/posts" class="btn-back mt-3">Back</a>
  </div>

  <div *ngIf="!isLoading && post" class="post-details-wrapper">
    
    <div class="post-header">
      <div class="top-row">
        <a routerLink="/admin/posts" class="btn-back"><i class="bi bi-arrow-left"></i> Back</a>
        
        <div class="actions" *ngIf="canEdit">
          <a [routerLink]="['/admin/posts/edit', post.id]" class="btn-action edit"><i class="bi bi-pencil"></i> Edit</a>
          <button (click)="onDelete()" class="btn-action delete"><i class="bi bi-trash"></i> Delete</button>
        </div>
      </div>

      <span class="category-badge">{{ getCategoryName(post.category) }}</span>
      <h1 class="post-title">{{ post.title }}</h1>

      <div class="author-meta">
        <img [src]="post.author?.imageUrl ? environment.apiBaseUrl.replace('/api', '') + '/avatars/' + post.author!.imageUrl : 'assets/images/default-avatar.png'" class="avatar">
        <div class="info">
          <span class="name">{{ post.author?.fullName }}</span>
          <span class="date">{{ post.createdAt | date:'mediumDate' }}</span>
        </div>
      </div>
    </div>

    <div class="featured-image-container" *ngIf="post.imageUrl">
      <img [src]="post.imageUrl.startsWith('http') ? post.imageUrl : environment.apiBaseUrl.replace('/api', '') + '/posts/' + post.imageUrl">
    </div>

    <div class="post-content" [innerHTML]="post.content"></div>

    <div class="interaction-bar">
      <div class="stats-count">
        <span><i class="bi bi-hand-thumbs-up-fill text-primary"></i> {{ post.stats?.likes }}</span>
        <span><i class="bi bi-chat-dots-fill text-warning"></i> {{ post.stats?.comments }}</span>
      </div>
      
      <div class="action-buttons">
        <button class="btn-interact" 
                [class.active]="post.userInteraction === InteractionType.Like"
                (click)="toggleInteraction(InteractionType.Like)">
          <i class="bi bi-hand-thumbs-up"></i> Like
        </button>
        
        <button class="btn-interact" 
                [class.active]="post.userInteraction === InteractionType.Dislike"
                (click)="toggleInteraction(InteractionType.Dislike)">
          <i class="bi bi-hand-thumbs-down"></i> Dislike
        </button>
        
        <button class="btn-interact" onclick="document.getElementById('commentInput').focus()">
          <i class="bi bi-chat"></i> Comment
        </button>
      </div>
    </div>

    <div class="comments-section">
      <h3>Comments</h3>

      <div class="comment-input-box">
        <textarea id="commentInput" [(ngModel)]="newCommentContent" placeholder="Write a comment..."></textarea>
        <button class="btn-send" (click)="submitComment()" [disabled]="!newCommentContent.trim()">
          <i class="bi bi-send"></i>
        </button>
      </div>

      <div class="comments-list">
        <div class="comment-item" *ngFor="let comment of post.comments">
          <img [src]="comment.author?.imageUrl ? environment.apiBaseUrl.replace('/api', '') + '/avatars/' + comment.author.imageUrl : 'assets/images/default-avatar.png'" class="comment-avatar">
          
          <div class="comment-body">
            <div class="bubble">
              <span class="author-name">{{ comment.author.fullName }}</span>
              <p class="text">{{ comment.content }}</p>
            </div>
            
            <div class="comment-actions">
              <button (click)="comment.isReplying = !comment.isReplying">Reply</button>
              <span class="time">{{ comment.createdAt | date:'shortTime' }}</span>
            </div>

            <div class="reply-input-box" *ngIf="comment.isReplying">
              <input #replyInput type="text" placeholder="Write a reply...">
              <button (click)="submitReply(comment, replyInput.value); replyInput.value=''">Reply</button>
            </div>

            <div class="replies-list" *ngIf="comment.replies?.length">
              <div class="comment-item reply" *ngFor="let reply of comment.replies">
                <img [src]="reply.author?.imageUrl ? environment.apiBaseUrl.replace('/api', '') + '/avatars/' + reply.author.imageUrl : 'assets/images/default-avatar.png'" class="comment-avatar small">
                <div class="bubble">
                  <span class="author-name">{{ reply.author.fullName }}</span>
                  <p class="text">{{ reply.content }}</p>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>

  </div>
</div>