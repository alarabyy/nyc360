<div class="page-container page-fade-in">
  
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner-border text-copper" role="status"></div>
    <p>Loading Profile...</p>
  </div>

  <div *ngIf="!isLoading && errorMessage" class="error-container">
    <i class="bi bi-exclamation-triangle"></i>
    <p>{{ errorMessage }}</p>
  </div>

  <div *ngIf="!isLoading && userProfile" class="profile-layout">
    
    <div class="profile-sidebar">
      <div class="user-card">
        
        <div class="avatar-container">
          <img [src]="imagePreview || (userProfile.imageUrl ? environment.apiBaseUrl + '/avatas/' + userProfile.imageUrl : '')" 
               class="avatar-img" 
               *ngIf="userProfile.imageUrl || imagePreview">
          
          <div *ngIf="!userProfile.imageUrl && !imagePreview" class="avatar-placeholder">
            {{ getInitials() }}
          </div>

          <label *ngIf="isEditMode" class="edit-avatar-btn">
            <i class="bi bi-camera-fill"></i>
            <input type="file" (change)="onFileSelected($event)" accept="image/*" hidden>
          </label>
        </div>

        <h2 class="user-name">{{ getDisplayName() }}</h2>
        <p class="user-role">
          {{ userProfile.type === UserType.Organization ? 'Organization' : 'Member' }}
        </p>

        <div class="divider"></div>

        <div class="stats-row" *ngIf="userProfile.type !== UserType.Admin">
          <div class="stat-item">
            <span class="value">{{ (userProfile.type === 0 ? regularData.stats.postsCount : orgData.stats.postsCount) || 0 }}</span>
            <span class="label">Posts</span>
          </div>
          <div class="stat-item">
            <span class="value">{{ (userProfile.type === 0 ? regularData.stats.followersCount : orgData.stats.followersCount) || 0 }}</span>
            <span class="label">Followers</span>
          </div>
        </div>

      </div>
    </div>

    <div class="profile-content">
      
      <div class="content-header">
        <h3>Profile Details</h3>
        <div class="header-actions">
          <button class="btn-edit" (click)="toggleEditMode()" *ngIf="!isEditMode">
            <i class="bi bi-pencil-square"></i> Edit Profile
          </button>
        </div>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="saveChanges()">
        
        <div *ngIf="userProfile.type === UserType.Organization">
          <div class="form-group">
            <label>Organization Name</label>
            <input [readonly]="!isEditMode" formControlName="name" type="text">
          </div>
          <div class="form-group">
            <label>Bio / About</label>
            <textarea [readonly]="!isEditMode" formControlName="bio" placeholder="Describe your organization..."></textarea>
          </div>
        </div>

        <div *ngIf="userProfile.type !== UserType.Organization">
          <div class="form-row">
            <div class="form-group">
              <label>First Name</label>
              <input [readonly]="!isEditMode" formControlName="firstName" type="text">
            </div>
            <div class="form-group">
              <label>Last Name</label>
              <div class="input-wrapper">
                <input [readonly]="!isEditMode" formControlName="lastName" type="text">
              </div>
            </div>
          </div>
          
          <div class="form-group" *ngIf="userProfile.type === UserType.Regular">
            <label>Bio</label>
            <textarea [readonly]="!isEditMode" formControlName="bio" placeholder="Tell us about yourself..."></textarea>
          </div>
        </div>

        <div class="form-group">
          <label>Email Address</label>
          <input readonly [value]="userProfile.email || 'N/A'" type="email" class="readonly-field">
        </div>

        <div class="form-actions" *ngIf="isEditMode">
          <button type="button" class="btn-cancel" (click)="toggleEditMode()">Cancel</button>
          <button type="submit" class="btn-save" [disabled]="isSaving">
            {{ isSaving ? 'Saving...' : 'Save Changes' }}
          </button>
        </div>

      </form>

    </div>

  </div>
</div>